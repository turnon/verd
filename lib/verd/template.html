<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>erd</title>
  <link rel="stylesheet" type="text/css" href="http://unpkg.com/view-design/dist/styles/iview.css">
  <script type="text/javascript" src="http://vuejs.org/js/vue.min.js"></script>
  <script type="text/javascript" src="http://unpkg.com/view-design/dist/iview.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/echarts@4.1.0/dist/echarts.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue-echarts@4.0.2"></script>
</head>

<body>
  <div id="filter-panel">
    <Drawer placement="left" v-model="filter" :mask-closable="false" :mask="false" :draggable="true" :transfer="false">
      <Tree :data="relations" show-checkbox />
    </Drawer>
    <Button @click="filter = !filter" type="primary">Open</Button>
  </div>

  <div id="graph" style="height: 100%">
    <v-chart :options="opts" theme="light" />
  </div>

  <script>
    (function () {
      let associations = [{
        src: 'A',
        dest: 'B'
      },
      {
        src: 'A',
        dest: 'C'
      },
      {
        src: 'D',
        dest: 'E'
      },
      {
        src: 'D',
        dest: 'F'
      }
      ]

      let group_by_src = {}

      associations.forEach((asso) => {
        if (!group_by_src[asso.src]) {
          group_by_src[asso.src] = {
            title: asso.src,
            expand: true,
            children: []
          }
        }
        group_by_src[asso.src].children.push({
          title: asso.dest
        })
      })

      let relations = Object.values(group_by_src)

      new Vue({
        el: '#filter-panel',
        data: {
          filter: false,
          relations: relations
        },
        methods: {}
      })

      let graph =
      //start-sub
      {
        "nodes": [{ "name": "n1", "category": 0 }, { "name": "n2", "category": 1 }, { "name": "n3", "category": 2 }],
        "links": [{ "id": 0, "source": "n1", "target": "n2" }, { "id": 1, "source": "n2", "target": "n3" }, { "id": 2, "source": "n3", "target": "n1" }],
        "categories": [{ "name": "/A" }, { "name": "/B" }, { "name": "/C" }]
      }
      //end-sub

      Vue.component('v-chart', VueECharts)
      new Vue({
        el: '#graph',
        data: {
          opts: {
            // title: {
            //   text: 'Les Miserables',
            //   subtext: 'Default layout',
            //   top: 'bottom',
            //   left: 'right'
            // },
            tooltip: {},
            legend: [{
              // selectedMode: 'single',
              data: graph.categories.map(function (a) {
                return a.name;
              })
            }],
            animationDuration: 1500,
            animationEasingUpdate: 'quinticInOut',
            series: [{
              name: 'Les Miserables',
              type: 'graph',
              layout: 'force',
              data: graph.nodes,
              links: graph.links,
              categories: graph.categories,
              roam: true,
              focusNodeAdjacency: true,
              itemStyle: {
                borderColor: '#fff',
                borderWidth: 1,
                shadowBlur: 10,
                shadowColor: 'rgba(0, 0, 0, 0.3)'
              },
              label: {
                position: 'right',
                formatter: '{b}'
              },
              lineStyle: {
                color: 'source',
                // curveness: 0.3
              },
              edgeSymbolSize: 15,
              emphasis: {
                lineStyle: {
                  width: 10
                }
              }
            }]
          }
        },
        methods: {}
      })
    })()
  </script>
</body>

</html>